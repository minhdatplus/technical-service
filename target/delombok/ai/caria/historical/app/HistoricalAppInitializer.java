// Generated by delombok at Wed May 26 23:25:48 ICT 2021
package ai.caria.historical.app;

import ai.caria.historical.buffer.DefaultHistoricalBufferInitializer;
import ai.caria.historical.core.HistoricalContext;
import ai.caria.historical.model.mysql.JdbiHelper;
import ai.caria.historical.model.mysql.HistoricalMySqlModelFactory;
import io.gridgo.utils.pojo.translator.ValueTranslators;

public class HistoricalAppInitializer {
    @java.lang.SuppressWarnings("all")
    private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(HistoricalAppInitializer.class);
    private final HistoricalAppConfig config;

    public HistoricalAppInitializer(HistoricalAppConfig config) {
        this.config = config;
    }

    public HistoricalContext init() {
        return initHistoricalApp();
    }

    private HistoricalContext initHistoricalApp() {
        ValueTranslators.getInstance().scan("ai.caria");
        org.jdbi.v3.core.Jdbi jdbi = JdbiHelper.createJdbiFromProperties(config.getDatabaseProperties());
        ai.caria.historical.model.mysql.HistoricalMySqlModelFactory modelFactory = new HistoricalMySqlModelFactory(jdbi);
        ai.caria.historical.buffer.DefaultHistoricalBufferInitializer bufferInitializer = DefaultHistoricalBufferInitializer.builder().HistoricalModelFactory(modelFactory).build();
        ai.caria.historical.buffer.HistoricalBuffer HistoricalBuffer = bufferInitializer.init();
        return DefaultHistoricalContext.builder().modelFactory(modelFactory).historicalBuffer(HistoricalBuffer).build();
    }
}
